{"version":3,"sources":["../src/util.js"],"names":["_","Util","templateSrv","target","options","variableNames","variables","map","v","name","resolved","forEach","indexOf","values","getVarValues","scopedVars","newResolved","regex","RegExp","push","newTarget","replace","val","isArray","join","charAt","substring","length","split","variableExists","obj","re","test","result","d","i","text","value","tmp_str","isEmpty","exists","resolve","Object","keys","str_var","templateToStr","includes","str_var_array","result_array","input","key_str","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","String","fromCharCode","decode","decode_text","string","c","c1","c2","charCodeAt","c3"],"mappings":"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","file":"util.js","sourcesContent":["import _ from 'lodash';\n\nexport class Util {\n\n  constructor(templateSrv) {\n    this.templateSrv = templateSrv;\n  }\n\n  resolve(target, options) {\n    const variableNames = (this.templateSrv.variables || []).map(v => '$' + v.name);\n    // For each variable in target, and each values of a given variable, build a resolved target string\n    let resolved = [target];\n    if (variableNames) {\n      variableNames.forEach(name => {\n        if (target.indexOf(name) >= 0) {\n          const values = this.getVarValues(name, options.scopedVars);\n          const newResolved = [];\n          const regex = new RegExp('\\\\' + name, 'g');\n          values.forEach(val => {\n            resolved.forEach(newTarget => {\n              newResolved.push(newTarget.replace(regex, val));\n            });\n          });\n          resolved = newResolved;\n        }\n      });\n    }\n    return resolved;\n  }\n\n  resolveForQL(target, options) {\n    return this.templateSrv.replace(target, options.scopedVars, values => {\n      if (_.isArray(values)) {\n        return values.map(v => `'${v}'`).join(',');\n      }\n      return `'${values}'`;\n    });\n  }\n\n  getVarValues(name, scopedVars) {\n    const values = this.templateSrv.replace(name, scopedVars);\n    // result might be in like \"{id1,id2,id3}\" (as string)\n    if (values.charAt(0) === '{') {\n        return values.substring(1, values.length-1).split(',');\n    }\n    return [values];\n  }\n\n  exists(name) {\n    return this.templateSrv.variableExists(name);\n  }\n\n  isEmpty(obj) { \n    var re = new RegExp(\"^[ ]+$\");\n    if(!obj || obj == \"null\" || obj == null || obj == \" \" || obj == \"\" \n      || obj == '\"\"' || re.test(obj) || typeof(obj) == \"undefined\"){\n      return true\n    }// 为空\n    return false; // 不为空\n  }\n\n  //将数组处理成Map对象集 \n  arrayToMap(result) {\n    return _.map(result, (d, i) => {\n      return { text: d, value: d };\n    });\n  }\n\n  //处理str模板变量数据\n  templateToStr(tmp_str){\n    if(this.isEmpty(tmp_str)){\n      return [];\n    }\n    tmp_str = this.exists(tmp_str) ? this.resolve(tmp_str, {}) : tmp_str;\n    if(\"object\" == typeof tmp_str && Object.keys(tmp_str).length){\n      tmp_str = tmp_str[0];\n    }\n    return tmp_str;\n  }\n\n  // 处理str类型字符串数组成[]类型\n  strToArray(str_var){\n    str_var = this.templateToStr(str_var);\n\n    if(str_var.includes(\"[\") || str_var.includes(\"]\")){\n      str_var = str_var.replace(\"[\", \"\").replace(\"]\", \"\");\n    }\n\n    var str_var_array = []\n    if(str_var.includes(\";\")){\n      str_var_array = str_var.split(\";\");\n    }else if(str_var.includes(\",\")){\n      str_var_array = str_var.split(\",\");\n    }else{\n      str_var_array.push(str_var);\n    }\n    var result_array = [];\n    str_var_array.forEach(i => {\n      i = this.exists(i) ? this.resolve(i, {}) : i;\n      result_array.push(i);\n    })\n\n    return result_array;\n  }\n\n  base64_decode(input){\n    var key_str = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var output = \"\";\n\t\tvar chr1, chr2, chr3;\n\t\tvar enc1, enc2, enc3, enc4;\n\t\tvar i = 0;\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\t\twhile (i < input.length) {\n\t\t\tenc1 = key_str.indexOf(input.charAt(i++));\n\t\t\tenc2 = key_str.indexOf(input.charAt(i++));\n\t\t\tenc3 = key_str.indexOf(input.charAt(i++));\n\t\t\tenc4 = key_str.indexOf(input.charAt(i++));\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\n\t\t\toutput = output + String.fromCharCode(chr1);\n\t\t\tif (enc3 != 64) {\n\t\t\t\toutput = output + String.fromCharCode(chr2);\n\t\t\t}\n\t\t\tif (enc4 != 64) {\n\t\t\t\toutput = output + String.fromCharCode(chr3);\n\t\t\t}\n\t\t}\n\t\treturn this.decode(output);\n  }\n\n  decode(decode_text){\n    var string = \"\";\n\t\tvar i = 0;\n\t\tvar c, c1, c2 = 0;\n\t\twhile ( i < decode_text.length ) {\n\t\t\tc = decode_text.charCodeAt(i);\n\t\t\tif (c < 128) {\n\t\t\t\tstring += String.fromCharCode(c);\n\t\t\t\ti++;\n\t\t\t} else if((c > 191) && (c < 224)) {\n\t\t\t\tc2 = decode_text.charCodeAt(i+1);\n\t\t\t\tstring += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n\t\t\t\ti += 2;\n\t\t\t} else {\n\t\t\t\tc2 = decode_text.charCodeAt(i+1);\n\t\t\t\tc3 = decode_text.charCodeAt(i+2);\n\t\t\t\tstring += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n\t\t\t\ti += 3;\n\t\t\t}\n\t\t}\n\t\treturn string;\n  }\n}"]}